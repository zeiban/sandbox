{"ts":1340764710403,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var requirejs = require('requirejs');\nrequirejs.config({\n        nodeRequire: require\n    });\n    \nrequirejs(['../../client/js/Messages'], function   (Messages) {\n    console.log(Messages);\n    var express = require('express'),\n        sio = require('socket.io');\n    \n    var app = express.createServer();\n    var sio = sio;\n    console.log(__dirname);\n    app.configure(function(){\n        app.use(express.static(__dirname + '/../../client'));\n    });\n    \n    app.listen(process.env.PORT);\n    \n    var io = sio.listen(app);\n\n    var clients = [];\n    var zombies = [];\n    \n    var timer = setInterval(function(){\n        //    console.log('Tick');\n            for(var z=0; z<zombies.length; z++) {\n                var props = zombies[z].properties;\n                props.position.x+=props.velocity.x;\n                props.position.y+=props.velocity.y;\n            }\n            \n            for(var i=0; i<clients.length; i++) {\n                for(var z=0; z<zombies.length; z++) {\n                    var zombie = zombies[z];\n                    clients[i].json.send({\n                        id:Messages.OBJECT,\n                            data:{\n                                id:zombie.id,\n                                properties:zombie.properties\n                            }\n                    });\n                }\n            }\n        }, 1000);\n    var nextObjId = 0;\n    \n    for(var i=0; i<50; i++) {\n        zombies.push({\n            id:nextObjId++,\n            properties:{\n                position:{\n                    x:(Math.random()*100) - 50,\n                    y:(Math.random()*100) - 50\n                },\n                velocity:{\n                    x:(Math.random()*10)-5,\n                    y:(Math.random()*10)-5\n                }\n            }\n        });\n    }\n    io.sockets.on('connection', function(socket) {\n        console.log('Connected ' + socket);\n        clients.push(socket);\n        \n        socket.on('message',function(msg){\n            console.log('Received: ' + msg);\n            if(msg.id === Messages.LOGIN) {\n                console.log(\"Authenticating: \" + msg.data.email);\n                playerId = nextObjId++;\n                zombies.push({\n                    id:playerId,\n                    properties:{\n                        position:{\n                            x:(Math.random()*100) - 50,\n                            y:(Math.random()*100) - 50\n                        },\n                        velocity:{\n                            x:0,\n                            y:0\n                        }\n                    }\n                })\n                socket.json.send({id:Messages.LOGIN, data:{retval:0,id:playerId}});\n            } else {\n                console.log(\"Unknown Message ID: \" + msg.id);\n            }\n        });\n        socket.on('disconnect',function(){\n            var i = clients.indexOf(socket);\n            clients.splice(i,1);\n            console.log('Disconnected: ' + socket);\n        });\n    });\n});\n"]],"start1":0,"start2":0,"length1":0,"length2":3005}]],"length":3005}
{"contributors":[],"silentsave":false,"ts":1340798843188,"patch":[[{"diffs":[[0,"  }\n"],[-1,"            \n"],[0,"    "]],"start1":868,"start2":868,"length1":21,"length2":8},{"diffs":[[0,".length; i++) {\n"],[1,""],[0,"                "]],"start1":906,"start2":906,"length1":32,"length2":32},{"diffs":[[0,"     }, "],[-1,"10"],[1,"5"],[0,"00);\n   "]],"start1":1339,"start2":1339,"length1":18,"length2":17},{"diffs":[[0,"        "],[1,"var "],[0,"playerId"]],"start1":2132,"start2":2132,"length1":16,"length2":20},{"diffs":[[0,"      })"],[1,";"],[0,"\n       "]],"start1":2596,"start2":2596,"length1":16,"length2":17},{"diffs":[[0,"ket."],[-1,"json.send({id:Messages.LOGIN, data:{retval:0,id:playerId}"],[1,"set('playerId',playerId,function(){\n                    socket.json.send({id:Messages.LOGIN, data:{retval:0,id:playerId}});\n                });\n            } else if (msg.id === Messages.MOVE_LEFT){\n                socket.get('playerId',function(err,id){\n                    var player = zombies[id];\n                    if(msg.date.state === 1) {\n                        player.properties.velocity.y = -5;\n                    } else {\n                        player.properties.velocity.y = 0;\n                    }\n                });\n            } else if (msg.id === Messages.MOVE_RIGHT){\n                socket.get('playerId',function(err,id){\n                    var player = zombies[id];\n                    if(msg.date.state === 1) {\n                        player.properties.velocity.x = -5;\n                    } else {\n                        player.properties.velocity.x = 0;\n                    }\n                "],[0,"});\n"]],"start1":2625,"start2":2625,"length1":65,"length2":933}]],"length":3864,"saved":false}
